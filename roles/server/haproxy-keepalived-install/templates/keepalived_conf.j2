! Configuration File for keepalived

global_defs {
  notification_email {
    {{ keepalived_to_email }}
  }
  notification_email_from {{ keepalived_from_email }}
  smtp_server 192.168.200.1
  smtp_connect_timeout 30
  router_id LVS_DEVEL
  vrrp_skip_check_adv_addr
  vrrp_strict
  vrrp_garp_interval 0
  vrrp_gna_interval 0
}

vrrp_script chk_haproxy {
 script "killall -0 haproxy" # check the haproxy process
 interval 2 # every 2 seconds
 weight 2 # add 2 points if OK
}

vrrp_instance VI_1 {
   state MASTER
   interface eth0
   virtual_router_id {{ vrrp_rid}}
   {% if hostvars[inventory_hostname]['ansible_default_ipv4']['address'] == groups["haproxy"][0] %}
   priority 101   ///set to 100 on slave ha proxy
   {% else %}
   priority 100   ///set to 100 on slave ha proxy
   {% endif %}
   advert_int 1
   authentication {
       auth_type PASS
       auth_pass 1111
   }
   virtual_ipaddress {
       {{ haproxy_vip }}
   }
}

